@startuml class_diagram

skinparam classAttributeIconSize 0
skinparam linetype ortho

package "com.detonomics.budgettuner.controller" {
    class BudgetTunerCLI {
        - BudgetTunerCLI()
        + {static} main(args : String[]) : void
    }
}

package "com.detonomics.budgettuner.model" {
    class BudgetYear {
        - summary : Summary
        - revenues : ArrayList<RevenueCategory>
        - expenses : ArrayList<ExpenseCategory>
        - ministries : ArrayList<Ministry>
        - ministryExpenses : ArrayList<MinistryExpense>
        ~ BudgetYear(summary : Summary, revenues : ArrayList<RevenueCategory>, expenses : ArrayList<ExpenseCategory>, ministries : ArrayList<Ministry>, ministryExpenses : ArrayList<MinistryExpense>)
        ~ getSummary() : Summary
        ~ getRevenues() : ArrayList<RevenueCategory>
        ~ getExpenses() : ArrayList<ExpenseCategory>
        ~ getMinistries() : ArrayList<Ministry>
        ~ getMinistryExpenses() : ArrayList<MinistryExpense>
    }

    class Summary {
        - sourceTitle : String
        - currency : String
        - locale : String
        - sourceDate : String
        - budgetYear : int
        - totalRevenues : long
        - totalExpenses : long
        - budgetResult : long
        - coverageWithCashReserves : long
        ~ Summary(sourceTitle : String, currency : String, locale : String, sourceDate : String, budgetYear : int, totalRevenues : long, totalExpenses : long, budgetResult : long, coverageWithCashReserves : long)
        ~ getSourceTitle() : String
        ~ getTotalRevenues() : long
        ~ totalExpenses() : long
        + toString() : String
    }

    class Ministry {
        - ministryID : int
        - code : long
        - name : String
        - regularBudget : long
        - publicInvestmentBudget : long
        - totalBudget : long
        ~ Ministry(ministryID : int, code : long, name : String, regularBudget : long, publicInvestmentBudget : long, totalBudget : long)
        ~ getMinistryID() : int
        ~ getName() : String
        ~ getTotalBudget() : long
        + toString() : String
    }

    class MinistryExpense {
        - ministryExpenseID : int
        - ministryID : int
        - expenseCategoryID : int
        - amount : long
        ~ MinistryExpense(ministryExpenseID : int, ministryID : int, expenseCategoryID : int, amount : long)
        ~ getAmount() : long
        + toString() : String
    }

    class RevenueCategory {
        - revenueID : int
        - code : long
        - name : String
        - amount : long
        - parentID : int
        ~ RevenueCategory(revenueID : int, code : long, name : String, amount : long, parentID : int)
        ~ getCode() : long
        ~ getName() : String
        ~ getAmount() : long
        + toString() : String
    }

    class ExpenseCategory {
        - expenseID : int
        - code : long
        - name : String
        - amount : long
        ~ ExpenseCategory(expenseID : int, code : long, name : String, amount : long)
        ~ getCode() : long
        ~ getName() : String
        ~ getAmount() : long
        + toString() : String
    }

    class SqlSequence {
        - budgets : int
        - revenueCategories : int
        - expenseCategories : int
        - ministries : int
        - ministryExpenses : int
        ~ SqlSequence(budgets : int, revenueCategories : int, expenseCategories : int, ministries : int, ministryExpenses : int)
        ~ getBudgets() : int
    }
}

package "com.detonomics.budgettuner.dao" {
    class DaoConfig {
        - {static} dbPath : String
        - DaoConfig()
        + {static} getDbPath() : String
        + {static} setDbPath(path : String) : void
    }

    class BudgetYearDao {
        - BudgetYearDao()
        + {static} loadBudgetYearsList() : ArrayList<Integer>
        + {static} loadBudgetIDByYear(year : int) : int
        + {static} loadBudgetYear(budgetID : int) : BudgetYear
        + {static} insertNewBudgetYear(pdfPath : String) : void
    }

    class SummaryDao {
        - SummaryDao()
        + {static} loadSummary(budgetID : int) : Summary
    }

    class RevenueCategoryDao {
        - RevenueCategoryDao()
        + {static} loadRevenues(budgetID : int) : ArrayList<RevenueCategory>
        + {static} loadRevenueCategoryIDFromCode(code : long) : int
        + {static} loadRevenueAmount(revenueCategoryId : int) : long
        + {static} loadRevenueParentID(revenueCategoryId : int) : int
        + {static} loadRevenueChildren(revenueCategoryId : int) : ArrayList<Integer>
        + {static} setRevenueAmount(code : long, amount : long) : int
    }
    
    class ExpenseCategoryDao {
        - ExpenseCategoryDao()
        + {static} loadExpenses(budgetID : int) : ArrayList<ExpenseCategory>
    }
    
    class MinistryDao {
        - MinistryDao()
        + {static} loadMinistries(budgetID : int) : ArrayList<Ministry>
    }
    
    class MinistryExpenseDao {
        - MinistryExpenseDao()
        + {static} loadMinistryExpenses(budgetID : int) : ArrayList<MinistryExpense>
    }

    class SqlSequenceDao {
        - SqlSequenceDao()
        + {static} loadSqliteSequence() : SqlSequence
    }
}

package "com.detonomics.budgettuner.util" {
    class DatabaseManager {
        - DatabaseManager()
        + {static} executeUpdate(dbPath : String, sql : String, params : Object[]) : int
        + {static} executeQuery(dbPath : String, sql : String, params : Object[]) : List<Map<String, Object>>
    }

    class BudgetFormatter {
        - BudgetFormatter()
        + {static} formatAmount(amount : long) : String
        + {static} getFormattedRevenues(revenues : ArrayList<RevenueCategory>) : String
        + {static} getFormattedExpenditures(expenditures : ArrayList<ExpenseCategory>) : String
        + {static} getFormattedMinistries(ministries : ArrayList<Ministry>) : String
        + {static} getFormattedMinistryExpenses(ministries : ArrayList<Ministry>, expenseCategories : ArrayList<ExpenseCategory>, ministryExpenses : ArrayList<MinistryExpense>) : String
    }
}

package "com.detonomics.budgettuner.service" {
    class IngestBudgetPdf {
        - IngestBudgetPdf()
        + {static} process(pdfPath : String) : void
        + {static} main(args : String[]) : void
    }
}

package "com.detonomics.budgettuner.util.ingestion" {
    class PdfToText {
        + extractAndSaveText(pdfPath : String) : void
    }

    class TextToJson {
        - TextToJson()
        + {static} textFileToJson(inTxt : Path, outJson : Path) : void
    }

    class JsonToSQLite {
        + main(args : String[]) : void
        + processAndStoreBudget(jsonFilePath : String) : void
    }
}

' Relationships

BudgetTunerCLI ..> BudgetYearDao : uses
BudgetTunerCLI ..> SqlSequenceDao : uses
BudgetTunerCLI ..> BudgetFormatter : uses
BudgetTunerCLI ..> BudgetYear : uses
BudgetTunerCLI ..> SqlSequence : uses

BudgetYear *-- Summary : contains
BudgetYear o-- RevenueCategory : contains
BudgetYear o-- ExpenseCategory : contains
BudgetYear o-- Ministry : contains
BudgetYear o-- MinistryExpense : contains

BudgetYearDao ..> SummaryDao : uses
BudgetYearDao ..> RevenueCategoryDao : uses
BudgetYearDao ..> ExpenseCategoryDao : uses
BudgetYearDao ..> MinistryDao : uses
BudgetYearDao ..> MinistryExpenseDao : uses
BudgetYearDao ..> IngestBudgetPdf : uses
BudgetYearDao ..> DatabaseManager : uses
BudgetYearDao ..> BudgetYear : creates

SummaryDao ..> DatabaseManager : uses
SummaryDao ..> Summary : creates
SummaryDao ..> DaoConfig : uses

RevenueCategoryDao ..> DatabaseManager : uses
RevenueCategoryDao ..> RevenueCategory : creates
RevenueCategoryDao ..> DaoConfig : uses

ExpenseCategoryDao ..> DatabaseManager : uses
ExpenseCategoryDao ..> ExpenseCategory : creates
ExpenseCategoryDao ..> DaoConfig : uses

MinistryDao ..> DatabaseManager : uses
MinistryDao ..> Ministry : creates
MinistryDao ..> DaoConfig : uses

MinistryExpenseDao ..> DatabaseManager : uses
MinistryExpenseDao ..> MinistryExpense : creates
MinistryExpenseDao ..> DaoConfig : uses

SqlSequenceDao ..> DatabaseManager : uses
SqlSequenceDao ..> SqlSequence : creates
SqlSequenceDao ..> DaoConfig : uses

BudgetYearDao ..> DaoConfig : uses

BudgetFormatter ..> RevenueCategory : formats
BudgetFormatter ..> ExpenseCategory : formats
BudgetFormatter ..> Ministry : formats
BudgetFormatter ..> MinistryExpense : formats

IngestBudgetPdf ..> PdfToText : uses
IngestBudgetPdf ..> TextToJson : uses
IngestBudgetPdf ..> JsonToSQLite : uses

' Layout adjustments for vertical aspect ratio
BudgetTunerCLI -[hidden]-> BudgetYearDao
BudgetYearDao -[hidden]-> BudgetYear
BudgetYear -[hidden]-> IngestBudgetPdf

' Stack Model classes
Summary -[hidden]-> RevenueCategory
RevenueCategory -[hidden]-> ExpenseCategory
ExpenseCategory -[hidden]-> Ministry
Ministry -[hidden]-> MinistryExpense
MinistryExpense -[hidden]-> SqlSequence

' Stack DAO classes
BudgetYearDao -[hidden]-> DaoConfig
DaoConfig -[hidden]-> SummaryDao
SummaryDao -[hidden]-> RevenueCategoryDao
RevenueCategoryDao -[hidden]-> ExpenseCategoryDao
ExpenseCategoryDao -[hidden]-> MinistryDao
MinistryDao -[hidden]-> MinistryExpenseDao
MinistryExpenseDao -[hidden]-> SqlSequenceDao

' Stack Utils
DatabaseManager -[hidden]-> BudgetFormatter

' Stack Ingestion
IngestBudgetPdf -[hidden]-> PdfToText
PdfToText -[hidden]-> TextToJson
TextToJson -[hidden]-> JsonToSQLite

@enduml
