@startuml

skinparam classAttributeIconSize 0
skinparam linetype ortho

package "com.detonomics.budgettuner.backend.mainapplicationfeatures" {

    class App {
        - App()
        + {static} main(args : String[]) : void
    }

    class BudgetYear {
        - summary : Summary
        - revenues : ArrayList<RevenueCategory>
        - expenses : ArrayList<ExpenseCategory>
        - ministries : ArrayList<Ministry>
        - ministryExpenses : ArrayList<MinistryExpense>
        ~ BudgetYear(summary : Summary, revenues : ArrayList<RevenueCategory>, expenses : ArrayList<ExpenseCategory>, ministries : ArrayList<Ministry>, ministryExpenses : ArrayList<MinistryExpense>)
        ~ getSummary() : Summary
        ~ getRevenues() : ArrayList<RevenueCategory>
        ~ getExpenses() : ArrayList<ExpenseCategory>
        ~ getMinistries() : ArrayList<Ministry>
        ~ getMinistryExpenses() : ArrayList<MinistryExpense>
    }

    class Summary {
        - sourceTitle : String
        - currency : String
        - locale : String
        - sourceDate : String
        - budgetYear : int
        - totalRevenues : long
        - totalExpenses : long
        - budgetResult : long
        - coverageWithCashReserves : long
        ~ Summary(sourceTitle : String, currency : String, locale : String, sourceDate : String, budgetYear : int, totalRevenues : long, totalExpenses : long, budgetResult : long, coverageWithCashReserves : long)
        ~ getSourceTitle() : String
        ~ getTotalRevenues() : long
        ~ totalExpenses() : long
        + toString() : String
    }

    class Ministry {
        - ministryID : int
        - code : long
        - name : String
        - regularBudget : long
        - publicInvestmentBudget : long
        - totalBudget : long
        ~ Ministry(ministryID : int, code : long, name : String, regularBudget : long, publicInvestmentBudget : long, totalBudget : long)
        ~ getMinistryID() : int
        ~ getName() : String
        ~ getTotalBudget() : long
        + toString() : String
    }

    class MinistryExpense {
        - ministryExpenseID : int
        - ministryID : int
        - expenseCategoryID : int
        - amount : long
        ~ MinistryExpense(ministryExpenseID : int, ministryID : int, expenseCategoryID : int, amount : long)
        ~ getAmount() : long
        + toString() : String
    }

    class RevenueCategory {
        - revenueID : int
        - code : long
        - name : String
        - amount : long
        - parentID : int
        ~ RevenueCategory(revenueID : int, code : long, name : String, amount : long, parentID : int)
        ~ getCode() : long
        ~ getName() : String
        ~ getAmount() : long
        + toString() : String
    }

    class ExpenseCategory {
        - expenseID : int
        - code : long
        - name : String
        - amount : long
        ~ ExpenseCategory(expenseID : int, code : long, name : String, amount : long)
        ~ getCode() : long
        ~ getName() : String
        ~ getAmount() : long
        + toString() : String
    }

    class SqlSequence {
        - budgets : int
        - revenueCategories : int
        - expenseCategories : int
        - ministries : int
        - ministryExpenses : int
        ~ SqlSequence(budgets : int, revenueCategories : int, expenseCategories : int, ministries : int, ministryExpenses : int)
        ~ getBudgets() : int
    }

    class BudgetLoader {
        - {static} dbPath : String
        - BudgetLoader()
        ~ {static} loadBudgetYearsList() : ArrayList<Integer>
        ~ {static} loadBudgetIDByYear(year : int) : int
        ~ {static} loadBudgetYear(budgetID : int) : BudgetYear
        ~ {static} loadSqliteSequence() : SqlSequence
        ~ {static} loadRevenueCategoryIDFromCode(code : long) : int
        ~ {static} loadRevenueAmount(revenueCategoryId : int) : long
    }

    class BudgetModifier {
        - BudgetModifier()
        ~ {static} insertNewBudgetYear(pdfPath : String) : void
        ~ {static} setRevenueAmount(code : long, amount : long) : int
    }

    class DatabaseManager {
        - DatabaseManager()
        + {static} executeUpdate(dbPath : String, sql : String, params : Object[]) : int
        + {static} executeQuery(dbPath : String, sql : String, params : Object[]) : List<Map<String, Object>>
    }

    class BudgetFormatter {
        - BudgetFormatter()
        + {static} formatAmount(amount : long) : String
        + {static} getFormattedRevenues(revenues : ArrayList<RevenueCategory>) : String
        + {static} getFormattedExpenditures(expenditures : ArrayList<ExpenseCategory>) : String
        + {static} getFormattedMinistries(ministries : ArrayList<Ministry>) : String
        + {static} getFormattedMinistryExpenses(ministries : ArrayList<Ministry>, expenseCategories : ArrayList<ExpenseCategory>, ministryExpenses : ArrayList<MinistryExpense>) : String
    }
}

package "com.detonomics.budgettuner.backend.budgetingestion" {

    class IngestBudgetPdf {
        - IngestBudgetPdf()
        + {static} process(pdfPath : String) : void
        + {static} main(args : String[]) : void
    }

    class PdfToText {
        + extractAndSaveText(pdfPath : String) : void
    }

    class TextToJson {
        - TextToJson()
        + {static} textFileToJson(inTxt : Path, outJson : Path) : void
    }

    class JsonToSQLite {
        + main(args : String[]) : void
        + processAndStoreBudget(jsonFilePath : String) : void
    }
}

' Relationships

App ..> BudgetLoader : uses
App ..> BudgetModifier : uses
App ..> BudgetFormatter : uses
App ..> BudgetYear : uses
App ..> SqlSequence : uses

BudgetYear *-- Summary : contains
BudgetYear o-- RevenueCategory : contains
BudgetYear o-- ExpenseCategory : contains
BudgetYear o-- Ministry : contains
BudgetYear o-- MinistryExpense : contains

BudgetLoader ..> DatabaseManager : uses
BudgetLoader ..> BudgetYear : creates
BudgetLoader ..> Summary : creates
BudgetLoader ..> RevenueCategory : creates
BudgetLoader ..> ExpenseCategory : creates
BudgetLoader ..> Ministry : creates
BudgetLoader ..> MinistryExpense : creates
BudgetLoader ..> SqlSequence : creates

BudgetModifier ..> IngestBudgetPdf : uses
BudgetModifier ..> DatabaseManager : uses
BudgetModifier ..> BudgetLoader : uses

BudgetFormatter ..> RevenueCategory : formats
BudgetFormatter ..> ExpenseCategory : formats
BudgetFormatter ..> Ministry : formats
BudgetFormatter ..> MinistryExpense : formats

IngestBudgetPdf ..> PdfToText : uses
IngestBudgetPdf ..> TextToJson : uses
IngestBudgetPdf ..> JsonToSQLite : uses

@enduml
